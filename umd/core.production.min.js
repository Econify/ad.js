var AdJS=function(){"use strict";function t(t,e,s,n){var r,i=arguments.length,o=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,s):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,s,n);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(o=(i<3?r(o):i>3?r(e,s,o):r(e,s))||o);return i>3&&o&&Object.defineProperty(e,s,o),o}var e;!function(t){t.CREATE="create",t.REQUEST="request",t.RENDER="render",t.REFRESH="refresh",t.DESTROY="destroy",t.FREEZE="freeze",t.UNFREEZE="unfreeze",t.CLEAR="clear"}(e||(e={}));var s=e;class n extends Error{constructor(t,e){super(e),this.code=t,this.message=e}}function r(t,e={},s,n){const r=document.createElement(t);return Object.keys(e).forEach(t=>{const s=e[t];if("boolean"!=typeof s)r.setAttribute(t,s);else{if(!s)return;r.setAttribute(t,t)}}),"string"==typeof n&&(r.innerHTML=n),s.appendChild(r),r}const i=t=>t.reduce((t,e)=>t.then(()=>e()),Promise.resolve());function o(t,e,s){const n=s.value;return s.value=async function(...t){if(this.state.frozen){const s=this[e].bind(this,...t);return void this.actionsReceivedWhileFrozen.push(s)}const s=(r=e).charAt(0).toUpperCase()+r.slice(1);var r;const i=`before${s}`,o=`on${s}`,a=`after${s}`,c=`${e}ing`,h=`${e}ed`;this.state[c]||this.state[h]&&"refresh"!==e||(this.state[c]=!0,await this.onReady(async()=>{this.emit(e,"before"),await this.callPlugins(i);const s=n.apply(this,t),r=this.callPlugins(o);this.emit(e,"on"),await Promise.all([s,r]),await this.callPlugins(a),this.state[c]=!1,this.state[h]=!0,this.emit(e,"after")}))},s}class a{constructor(t,e,s){this.bucket=t,this.state={creating:!1,created:!1,rendering:!1,rendered:!1,refreshing:!1,refreshed:!1,clearing:!1,cleared:!1,destroying:!1,destroyed:!1,frozen:!1},this.actionsReceivedWhileFrozen=[],this.plugins=[],this.localVendors=[],this.promiseStack=Promise.resolve(),this.events={before:{},on:{},after:{}},this.promiseStack=this.promiseStack.then(()=>this.bucket.promiseStack),this.configuration=Object.assign({},this.bucket.defaults,s),this.container=r("div",{style:"position: relative; display: inline-block;"},e),this.el=r("div",{id:"adjs-ad-container-"},this.container),function(t){const{sizes:e,breakpoints:s}=t;if(!Array.isArray(e)&&!s)throw new n("Misconfiguration","Sizes must be of type `Array` unless breakpoints have been specified")}(this.configuration);const i=[...this.bucket.plugins];s&&s.plugins&&i.push(...s.plugins),this.attachPlugins(i);const o=this.callPlugins("beforeCreate");this.onReady(async()=>{await o,await Promise.all([this.networkInstance=this.network.createAd(this),this.callPlugins("onCreate")]),await this.callPlugins("afterCreate")})}get network(){return this.bucket.network}get slot(){return this.networkInstance.slot}get vendors(){return[...this.bucket.vendors,...this.localVendors]}onReady(t){let e,s;const n=new Promise((t,n)=>{e=t,s=n});return this.promiseStack=this.promiseStack.then(async()=>{try{await t(),e()}catch(t){s(t)}}),n}async render(){await this.bucket.setAsActive(),await this.networkInstance.render()}async refresh(){await this.bucket.setAsActive(),void 0!==this.networkInstance.refresh?await this.networkInstance.refresh():(console.warn("\n Network does not support ad refreshing natively.\nDestroying and Recreating the ad. Make sure this is what you intended.\n      "),await this.networkInstance.destroy(),this.networkInstance=this.network.createAd(this),await this.networkInstance.render()),this.state.rendered=!0}async clear(){await this.networkInstance.clear(),this.state.rendered=!1}async destroy(){await this.networkInstance.destroy()}freeze(){this.state.frozen||(this.emit(s.FREEZE,"before"),this.state.frozen=!0,this.emit(s.FREEZE,"on"),this.emit(s.FREEZE,"after"))}async unfreeze(t={}){if(!this.state.frozen)return;this.emit(s.UNFREEZE,"before"),this.state.frozen=!1;const e=this.actionsReceivedWhileFrozen;this.actionsReceivedWhileFrozen=[],t.replayEventsWhileFrozen&&this.onReady(()=>i(e)),this.emit(s.UNFREEZE,"on"),this.emit(s.UNFREEZE,"after")}on(t,e){this.attachEvent(t,e,"on")}before(t,e){this.attachEvent(t,e,"before")}after(t,e){this.attachEvent(t,e,"after")}async emit(t,e="on"){const s=this.events[e][t];s&&await Promise.all(s.map(t=>t(this)))}attachEvent(t,e,s="on"){this.events[s][t]||(this.events[s][t]=[]),this.events[s][t].push(e)}attachPlugins(t){this.plugins=t.map(t=>"function"==typeof t?new t(this):t)}callPlugins(t){return Promise.all(this.plugins.map(async e=>{const s=e[t];"function"==typeof s&&await s.call(e,this)}))}}t([o],a.prototype,"render",null),t([o],a.prototype,"refresh",null),t([o],a.prototype,"clear",null),t([o],a.prototype,"destroy",null);const c=()=>"undefined"==typeof window,h={Plugins:{},Networks:{},Vendors:{}},l=c()?h:window._ADJS=window._ADJS||h;l.Plugins=l.Plugins||h.Plugins,l.Vendors=l.Vendors||h.Vendors,l.Networks=l.Networks||h.Networks;const d={get(t,e){const s=String(e);if(c()){if("symbol"==typeof e)return{};throw new Error("\nUsing the Networks or Plugins property on AdJS is only available when installing via script.\nIf you are compiling the AdJS library locally within your project, use require to\nspecify the plugin directly.\n\nExample:\n  import DFP from 'adjs/networks/DFP';\n  import AutoRender from 'adjs/plugins/AutoRender';\n\n  new AdJS.Bucket(DFP, {\n    plugins: [\n      AutoRender,\n    ],\n  });\n      ")}if(!t[s])throw new Error(`\nThe ${s} Plugin or Network has not been included in your bundle. Please\nmanually include the script tag associated with this plugin or network. You can see\ndocumentation on https://adjs.dev.\n\nExample:\n  <script src="https://cdn.adjs.dev/core.min.js"><\/script>\n  <script src="https://cdn.adjs.dev/DFP.min.js"><\/script>\n  <script src="https://cdn.adjs.dev/AutoRender.min.js"><\/script>\n\n  <script>\n    new AdJS.Bucket(AdJS.Networks.DFP, {\n      plugins: [\n        AdJS.Plugins.AutoRender,\n      ],\n    });\n  <\/script>\n      `);return t[s]}},u={Bucket:class{constructor(t,e={}){this.network=t,this.ads=[],this.promiseStack=Promise.resolve(),this.plugins=[],this.vendors=[],this.defaults={};const{defaults:s,plugins:n,vendors:r}=e;s&&(this.defaults=s),n&&(this.plugins=n),r&&(this.vendors=r)}Ad(t,e){return this.createAd(t,e)}createAd(t,e){const s=new a(this,t,e);return this.ads.push(s),s}get correlatorId(){const{correlatorId:t}=this.ads[0];return t}async setAsActive(){this.correlatorId&&u.activeCorrelatorId!==this.correlatorId&&(this.ads.forEach(t=>{t.clear()}),await this.network.resetCorrelator())}},Plugins:new Proxy(l.Plugins,d),Networks:new Proxy(l.Networks,d),Vendors:new Proxy(l.Vendors,d),activeCorrelatorId:null};return u}();
//# sourceMappingURL=core.production.min.js.map
